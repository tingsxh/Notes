## MySql 相关阅读笔记

### 事务

* 事务被认为是不可分割的最下隔离单元，但提到事务就必须会谈到其四大特性: 原子性，隔离性，一致性，持久性。
* 事务的持久性保障主要是依赖操作日志，任何修改数据的操作都会被记录操作日志，持久化至磁盘当中。

#### 隔离级别

* 未提交读、提交读、可重复读(MySql的默认隔离级别)、序列化串行读。

#### 并发下存在的问题

* 脏读：读取了其他线程还未提交的数据，比如A 修改了数据，B读取了其修改后的数据，但是A 又回滚了，导致B 读取到的其实是脏数据。
* 幻读：A线程 在第一次读取 和第二次读取直接，读取了B 线程修改的数据，造成两次结果不一致的问题。
* 不可重复读：与幻读类似

#### 数据库的锁

* mysql innoDB 是支持行级锁和表锁的。

```mysql
# 一种共享锁，其他事务可以对其进行读取，但不可修改
SELECT ... LOCK In SHARE MODE;
# 这是属于悲观锁的一种，排他锁，其他事务不可读写
SELECT ... FOR UPDATE;
```

#### 并发版本控制问题

* InnoDb 变相的是基于数据快照的方式来实现行级锁，对每行数据都新增了两个字段，分别是创建时间和删除时间，而且还保存了当前事务的版本号。只有当前事务id> 该版本号才可以对其进行读取。

### 索引

#### InnoDB 索引结构

##### B树

* 每个

* B 树： B树和平衡二叉树稍有不同的是B树属于多叉树又名平衡多路查找树（查找路径不只两个），数据库索引技术里大量使用者B树和B+树的数据结构 .
* B 树同样保持着左子树小于当前节点，右子树大于当前节点的排列顺序。
* B 树的每个节点都保存着 `当前关键字数据的指针，叶子节点的指针`，并且所有叶子节点都在同一层。
* B树相对于平衡二叉树的不同是，每个节点包含的关键字增多了 ,这样来说对于一颗树的层级就减少了，这样查找速度会更快

##### B+ 树

* B+ 树： B+ 树是在B树的基础上改进的一种数据结构。
* B+跟B树不同B+树的 **非叶子**节点不保存关键字记录的指针，只进行数据索引，这样使得B+树每个**非叶子**节点所能保存的关键字大大增加，层数就会更加少
* B+树**叶子**节点保存了父节点的所有关键字记录的指针，所有数据地址必须要到叶子节点才能获取到。所以每次数据查询的次数都一样；
* B+树叶子节点的关键字从小到大有序排列，左边结尾数据都会保存右边节点开始数据的指针。
* 非叶子节点的子节点数=关键字数（来源百度百科）虽然他们数据排列结构不一样，但其原理还是一样的Mysql 的B+树是用第一种方式实现）
* 在进行全表扫描的时候，只需要扫描所有叶子节点即可，速度会更快。
