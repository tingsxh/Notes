### 虚拟机栈分析

* 每次方法执行都等同于一次栈帧的入栈，每一个栈帧都含有如下几个部分
* 局部变量表，操作数栈，动态连接，方法返回地址。局部变量变主要存储方法参数，以及方法内部定义的变量，操作数栈主要用于算术运算或者调用其他方法时，参数的传递过程，动态连接存在的目的就是将方法的符号引用转换为直接引用，返回地址都是存储调用者的PC 计数器地址。
* 动态连接：因为方法调用的过程中存在多态的特性，有些方法需要等到运行时才能知道具体的方法，而有些方法，比如静态方法，内部方法，这些都是在类加载阶段就可以直接将符号引用转换为直接引用的，这种转换称之为静态解析。除此之外比如接口的方法，就需要等到运行时才知道接口的实现类是哪个，这种解析叫做动态解析。

#### 方法调用

* 问题点？

  普通方法和静态方法的区别？（使用层面，字节码调用层面）

  怎么理解static 关键字？（静态代码块的初始化顺序）

* 解析

  方法在代码写好，编译器进行编译的时候就已经可以明确调用的版本，这类方法的调用称之为解析，也就是在类加载阶段就会将符号引用直接替换为直接引用。

  运行期不可变的方法主要是包括静态方法，私有方法，父类方法，者几种方法都可以称之为非虚方法。一般使用

  `invokestatic` `invokespecial` 指令调用。

* 重载（静态分配）

  重载方法都选择是通过参数都静态类型来决定的，使用依赖参数的静态类型来决定方法分配的称之为静态分配，**静态分配的过程发生在编译阶段，注意类加载阶段发生的是解析**， 静态分配确定方法签名的依据主要是 **调用者的静态类型，以及方法参数的静态类型**这两种。举例如下

  ```java
  class P{
  }
  class A extend P{
    
  }
  class B extend P{
  }
  
  class C{
    public void test(P p){
      
    }
     public void test(A a){
      
    }
      public void test(B b){
      
    }
  }
  ```

  在重载方法的选择上还遵循如下规则 `char>int>long>float>double`

* 重写

  重写的本质就是多态的体现过程，通过方法调用指令`invokevirtual` 指令将符号引用解析到具体的实际类型，再确定方法的版本，这个过程就是动态分配。

* 除了以上几种方法调用指令之外，还有一种invokedynamic 动态方法调用，与其他几种区别在于，这种方法分配不是固化在虚拟机内部的，而是面向基于java虚拟机的其他种类的语言。