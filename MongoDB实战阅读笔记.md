[TOC]

# MongoDb笔记

* 文档型数据库，支持分片，主从复制，持久化，强一致性，以及支持B 树索引。

## 索引

## 复制

### 副本集复制

* 和redis 一致的是mondb其也是支持主从之间同步复制的，具体过程也是主节点负责写入，从节点负责数据读取。
* 主节点每次接收写入命令的时候都会记录一条日志至oplog 文件中，其中记录了操作时间。
* 从节点每次复制的时候，首先会检查自身的oplog 中最后一条记录，也就是最大的时间戳，然后将其与主节点中的oplog文件对比，将主节点文件中所有大于该时间戳的记录复制到从节点。
* 从节点使用的长轮训的方式，基本能保证数据同步的时效性。值得注意的是，如果oplog 太小，一下子被全部写满，导致从节点复制延迟了，从节点将会停止复制。

### 主从复制

* 不推荐使用主从复制的原因在于：当主节点发生故障时其完全是基于手工的故障转移，每次需要重启一个从节点使其成为主节点，然后剩余的从节点再进行同步。

## 分片

* 数据量过大，需要将数据库分布在不同的分片上，每个分片都形成一个独立的副本集。
* 客户端连接时，其实是连接的本地启动的mongos 进程，有mongos负责具体操作的路由。